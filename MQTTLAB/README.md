Этот проект представляет собой пример реализации взаимодействия с MQTT-брокером с использованием библиотеки **MQTTnet**. Проект состоит из двух основных частей: **Publisher** (отправитель) и **Subscriber** (подписчик). Они взаимодействуют с MQTT-брокером для отправки и получения сообщений. Подробное объяснение кода:

---

### **Основной функционал**

1. **Publisher (Отправитель):**
   - Подключается к MQTT-брокеру.
   - Позволяет пользователю вводить сообщения, которые отправляются на указанный топик (topic).
   - Поддерживает форматы сообщений: JSON, текст и бинарные данные.

2. **Subscriber (Подписчик):**
   - Подключается к MQTT-брокеру.
   - Подписывается на указанный топик.
   - Получает сообщения и обрабатывает их (например, выводит в консоль).

3. **Общий класс `Mqtt`:**
   - Реализует логику подключения к MQTT-брокеру, отправки и получения сообщений.
   - Поддерживает настройку SSL/TLS для безопасного подключения.

---

### **Основные классы и их функции**

#### 1. **`Program` (Publisher)**
   - **`Main` метод:**
     - Инициализирует сервисы (например, `IMemoryCache`, `ILogger`).
     - Читает конфигурацию из файла `appsettings.json`.
     - Создает объект `Mqtt` для взаимодействия с MQTT-брокером.
     - Вызывает метод `StartPublishAsync` для отправки сообщений.
   - **`StartPublishAsync` метод:**
     - Позволяет пользователю вводить сообщения.
     - Отправляет сообщения на указанный топик с помощью метода `PublishAsync`.

#### 2. **`Program` (Subscriber)**
   - **`Main` метод:**
     - Инициализирует сервисы (например, `ILogger`).
     - Читает конфигурацию из файла `appsettings.json`.
     - Создает объект `Mqtt` для взаимодействия с MQTT-брокером.
     - Подписывается на указанный топик с помощью метода `SubscribeAsync`.
     - Обрабатывает полученные сообщения с помощью метода `Handler`.
   - **`Handler` метод:**
     - Обрабатывает сообщения, полученные от MQTT-брокера.
     - Пытается десериализовать сообщение как JSON.
     - Если это не удается, обрабатывает сообщение как текст.

#### 3. **`Mqtt` (Общий класс)**
   - Реализует логику подключения к MQTT-брокеру, отправки и получения сообщений.
   - **Методы:**
     - `BuildAsync`: Настраивает подключение к MQTT-брокеру, включая SSL/TLS.
     - `Subscribe`: Подписывается на указанный топик.
     - `PublishAsync`: Отправляет сообщение на указанный топик в заданном формате (JSON, текст, бинарные данные).
   - **Событие `OnReceive`:**
     - Вызывается при получении сообщения от MQTT-брокера.
     - Передает данные в обработчик событий.

---

### **Как это работает**

1. **Инициализация:**
   - Приложение читает конфигурацию из файла `appsettings.json`.
   - Конфигурация включает параметры подключения к MQTT-брокеру (например, адрес сервера, имя пользователя, SSL/TLS настройки).

2. **Подключение к MQTT-брокеру:**
   - Используется библиотека **MQTTnet** для подключения к брокеру.
   - Поддерживается автоматическое переподключение в случае потери соединения.

3. **Отправка сообщений (Publisher):**
   - Пользователь вводит сообщение в консоль.
   - Сообщение отправляется на указанный топик с использованием метода `PublishAsync`.
   - Поддерживаются форматы: JSON, текст и бинарные данные.

4. **Получение сообщений (Subscriber):**
   - Подписчик подключается к MQTT-брокеру и подписывается на указанный топик.
   - При получении сообщения вызывается обработчик `Handler`.
   - Обработчик пытается десериализовать сообщение как JSON. Если это не удается, сообщение обрабатывается как текст.

5. **SSL/TLS:**
   - Поддерживается безопасное подключение с использованием SSL/TLS.
   - Настройки SSL/TLS считываются из конфигурации.

---

### **Пример использования**

#### **Publisher:**
1. Пользователь запускает приложение.
2. Вводит сообщение в консоль (например, `{"message": "Hello, MQTT!"}`).
3. Сообщение отправляется на топик, указанный в конфигурации.

#### **Subscriber:**
1. Подписчик подключается к MQTT-брокеру и подписывается на топик.
2. При получении сообщения выводит его в консоль.
3. Если сообщение является JSON, оно десериализуется и выводится в формате JSON.

---

### **Заключение**

Этот проект демонстрирует взаимодействие с MQTT-брокером с использованием библиотеки **MQTTnet**. Он поддерживает отправку и получение сообщений, а также настройку SSL/TLS для безопасного подключения. Код структурирован, чтобы быть расширяемым и поддерживаемым.